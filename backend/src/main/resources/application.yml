server:
  port: 8080
  tomcat:
    # Align Tomcat body limits with multipart settings to avoid large uploads being rejected before Spring handles them
    max-http-form-post-size: 50MB
    max-swallow-size: 50MB

spring:
  application:
    name: knohub-backend
  main:
    log-startup-info: false

  servlet:
    multipart:
      enabled: true
      max-file-size: 50MB
      max-request-size: 50MB

  datasource:
    url: ${DB_URL:jdbc:h2:file:./data/knohub;MODE=PostgreSQL;DB_CLOSE_DELAY=-1}
    driver-class-name: ${DB_DRIVER:org.h2.Driver}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:}

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    database-platform: ${DB_DIALECT:org.hibernate.dialect.H2Dialect}

logging:
  level:
    org.springframework.boot.autoconfigure: WARN
    org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener: OFF
    org.springframework: INFO
    org.springframework.beans: WARN
    org.springframework.context.annotation: WARN
    org.springframework.aop.framework.autoproxy: WARN
    org.springframework.aop.config: WARN
    org.springframework.transaction: WARN
    org.springframework.boot: WARN
    org.apache.catalina.core.AprLifecycleListener: ERROR
    org.apache.tomcat.util.net.NioEndpoint: WARN
    org.apache.tomcat.util.net.NioSelectorPool: WARN
    org.apache.coyote.http11.Http11NioProtocol: WARN
    org.hibernate: INFO
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    org.hibernate.orm.beans: WARN

# File storage configuration
file:
  upload-dir: ./uploads
  deleted-suffix-format: "_deleted_%d"

# Logisim rendering configuration
logisim:
  enabled: true
  # 默认指向 backend/logisim/logisim-evolution.jar
  jar-path: ${LOGISIM_JAR_PATH:./logisim/logisim-evolution.jar}
  # Example template for logisim-evolution:
  # command-template: "java -jar {{jar}} -tty image {{input}} {{output}} 2"
  command-template: ${LOGISIM_COMMAND_TEMPLATE:}
  output-format: png
  timeout-seconds: 20

cors:
  # Comma-separated additional origin patterns (e.g. https://*.example.com,https://*.trycloudflare.com)
  allowed-origin-patterns: ${CORS_ALLOWED_ORIGIN_PATTERNS:}
